@page "/overview"

<PageTitle>Noten Manager Übersicht</PageTitle>

@if (IsAccessDenied)
{
    <div class="alert alert-danger mt-5 text-center">
        <h4><i class="bi bi-x-circle-fill"></i> Zugriff verweigert</h4>
        <p>Sie haben keine Berechtigung, diese Seite zu sehen.</p>
    </div>
}
else if (Role == "teacher")
{
    <!-- ================== TEACHER HEADER ================== -->
    <nav class="navbar navbar-expand-lg border-bottom shadow-sm sticky-navbar">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://www.edu.ch/media/wysiwyg/edu/schulen/gibz.png?v=1" alt="GIBZ Logo" height="40">
            </a>

            <div class="d-flex align-items-center ms-auto gap-2">

                <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch"
                           checked="@IsDark"
                           @onchange="ToggleTheme" />
                    <label class="form-check-label small ms-1">
                        <i class="bi @(IsDark ? "bi-moon-stars-fill" : "bi-sun-fill")"></i>
                    </label>
                </div>

                <div class="dropdown">
                    <button class="btn dropdown-toggle"
                            type="button"
                            data-bs-toggle="dropdown"
                            data-bs-display="static"
                            aria-expanded="false">
                        <i class="bi bi-link"></i>
                    </button>

                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="https://www.zg.ch/behoerden/volkswirtschaftsdirektion/gibz"><i class="bi bi-house-door-fill"></i> | GIBZ Homepage</a></li>
                        <li><a class="dropdown-item" href="https://moodle.gibz.ch/anmelden/"><i class="bi bi-list-task"></i> | Moodle</a></li>
                        <li><a class="dropdown-item" href="https://gibz.sharepoint.com/"><i class="bi bi-bookmark-fill"></i> | Intranet</a></li>
                        <li><a class="dropdown-item" href="https://gibz.zg.ch/"><i class="bi bi-person-workspace"></i> | schulNetz GIBZ</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="mailto:info@gibz.ch?subject=Notennachfrage%20GIBZ"><i class="bi bi-envelope-fill"></i> | Kontaktieren <br /> Sie Uns!</a></li>
                    </ul>
                </div>

                <div class="vr mx-2"></div>

                <button class="btn btn-outline-danger btn-sm" @onclick="Logout">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <!-- ================== TEACHER TABS ================== -->
    <div class="bg-body border-bottom shadow-sm sticky-navbar" style="top:56px;">
        <div class="container">
            <ul class="nav nav-underline gap-3">
                <li class="nav-item">
                    <button class="btn nav-link @(teacherTab == "new" ? "active" : "")"
                            @onclick='() => teacherTab = "new"'>
                        <i class="bi bi-pencil-square"></i> Neue Note eintragen
                    </button>
                </li>
                <li class="nav-item">
                    <button class="btn nav-link @(teacherTab == "mine" ? "active" : "")"
                            @onclick="OpenMyRequests">
                        <i class="bi bi-inbox-fill"></i> Meine Anfragen
                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle ms-1 rounded-pill">
                            @MyPending.Count
                        </span>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="container content-padding" style="padding-top: 120px;">
        <div class="row justify-content-center">
            <div class="col-md-9 col-lg-8">

                @if (teacherTab == "new")
                {
                    <div id="success-alert" class="alert alert-success d-none shadow-sm" role="alert">
                        <h4 class="alert-heading"><i class="bi bi-check-circle-fill"></i> Gesendet!</h4>
                        <p>Der Notenantrag wurde erfolgreich an das Prorektorat übermittelt.</p>
                    </div>

                    <div class="card shadow border-0 rounded-3 mb-5" id="mainCard">
                        <div class="card-header bg-primary text-white p-3 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Neue Note erfassen</h5>
                        </div>

                        <div class="card-body p-4">
                            <EditForm Model="@gradeForm" OnValidSubmit="@ConfirmAction">
                                <DataAnnotationsValidator />

                                <div class="mb-3">
                                    <label class="form-label fw-bold text-secondary text-uppercase small">1. Modul</label>
                                    <InputText class="form-control form-control-lg" @bind-Value="gradeForm.ModuleName" />
                                    <ValidationMessage For="@(() => gradeForm.ModuleName)" />
                                </div>

                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <label class="form-label fw-bold text-secondary text-uppercase small">2. Klasse</label>
                                        <InputText class="form-control" @bind-Value="gradeForm.CourseName" />
                                        <ValidationMessage For="@(() => gradeForm.CourseName)" />
                                    </div>
                                    <div class="col-md-8 mb-3">
                                        <label class="form-label fw-bold text-secondary text-uppercase small">3. Schüler Name</label>
                                        <InputText class="form-control" @bind-Value="gradeForm.StudentName" />
                                        <ValidationMessage For="@(() => gradeForm.StudentName)" />
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-5">
                                        <label class="form-label fw-bold text-secondary text-uppercase small">Note (1.0 - 6.0)</label>
                                        <InputNumber class="form-control fw-bold text-center text-primary"
                                                     @bind-Value="gradeForm.GradeValue"
                                                     Min="1" Max="6" Step="0.1" />
                                        <ValidationMessage For="@(() => gradeForm.GradeValue)" />
                                        <small class="text-muted">Gerundet: @RoundedGrade</small>
                                    </div>

                                    <div class="col-md-7">
                                        <label class="form-label fw-bold text-secondary text-uppercase small mb-0">Rundungswunsch</label>
                                        <div class="border rounded p-2 bg-body-tertiary position-relative">
                                            <button type="button"
                                                    class="btn btn-sm btn-link position-absolute top-0 end-0 m-2 text-decoration-none"
                                                    @onclick="OpenAIHelper">
                                                <i class="bi bi-robot"></i> KI Hilfe
                                            </button>

                                            <div class="form-check mt-1">
                                                <input class="form-check-input" type="radio" name="rounding" id="roundNormal"
                                                       checked="@IsSelected("normal")"
                                                       @onchange="() => SetRounding(normal)" />
                                                <label class="form-check-label" for="roundNormal">Mathematisch</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="rounding" id="roundUp"
                                                       checked="@IsSelected("up")"
                                                       @onchange="() => SetRounding(up)" />
                                                <label class="form-check-label text-success" for="roundUp">Aufrunden (0.5)</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="rounding" id="roundDown"
                                                       checked="@IsSelected("down")"
                                                       @onchange="() => SetRounding(down)" />
                                                <label class="form-check-label text-danger" for="roundDown">Abrunden (0.5)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label fw-bold text-secondary text-uppercase small">Rektor</label>
                                    <InputSelect class="form-select form-select-lg" @bind-Value="gradeForm.RektorId">
                                        <option value="0">-- Wählen Sie einen Rektor --</option>
                                        @foreach (var rektor in Rektoren)
                                        {
                                            <option value="@rektor.Id">@rektor.Name</option>
                                        }
                                    </InputSelect>
                                    <span class="text-danger">@RektorValidationMessage</span>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label text-secondary small">Bemerkung (Optional)</label>
                                    <InputTextArea class="form-control" @bind-Value="gradeForm.Comment" rows="2" placeholder="Begründung..." />
                                </div>

                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg shadow-sm">
                                        Weiter zur Überprüfung <i class="bi bi-arrow-right"></i>
                                    </button>
                                </div>
                            </EditForm>
                        </div>
                    </div>
                }
                else if (teacherTab == "mine")
                {
                    <!-- Teacher Status Tabs -->
                    <div class="card border-0 shadow-sm mb-3">
                        <div class="card-body">
                            <ul class="nav nav-pills gap-2">
                                <li class="nav-item">
                                    <button class="btn btn-sm @(myTab == "pending" ? "btn-primary" : "btn-outline-primary")"
                                            @onclick='() => myTab = "pending"'>
                                        Offen <span class="badge bg-light text-dark ms-1">@MyPending.Count</span>
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="btn btn-sm @(myTab == "approved" ? "btn-success" : "btn-outline-success")"
                                            @onclick='() => myTab = "approved"'>
                                        Genehmigt <span class="badge bg-light text-dark ms-1">@MyApproved.Count</span>
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="btn btn-sm @(myTab == "rejected" ? "btn-danger" : "btn-outline-danger")"
                                            @onclick='() => myTab = "rejected"'>
                                        Abgelehnt <span class="badge bg-light text-dark ms-1">@MyRejected.Count</span>
                                    </button>
                                </li>

                                <li class="ms-auto">
                                    <button class="btn btn-sm btn-outline-secondary" @onclick="LoadMyGrades">
                                        <i class="bi bi-arrow-clockwise"></i> Aktualisieren
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>

                    @if (MyGrades.Count == 0)
                    {
                        <div class="text-center py-5">
                            <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                            <h3 class="text-muted mt-3">Keine Anfragen</h3>
                        </div>
                    }
                    else
                    {
                        var list = myTab == "pending" ? MyPending : myTab == "approved" ? MyApproved : MyRejected;

                        if (list.Count == 0)
                        {
                            <div class="text-center py-5">
                                <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                                <h3 class="text-muted mt-3">Keine Einträge</h3>
                            </div>
                        }
                        else
                        {
                            @foreach (var g in list)
                            {
                                <div class="card shadow-sm border-0 mb-3">
                                    <div class="card-body p-4">

                                        <div class="d-flex justify-content-between mb-2 border-bottom pb-2">
                                            <span class="text-muted small">
                                                <i class="bi bi-calendar3"></i> @g.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy")
                                            </span>
                                            <span class="text-muted small">
                                                <i class="bi bi-clock"></i> @g.CreatedAt.ToLocalTime().ToString("HH:mm") Uhr
                                            </span>
                                        </div>

                                        <div class="d-flex justify-content-between align-items-start gap-3">
                                            <div class="flex-grow-1">
                                                <div class="d-flex align-items-center gap-2 mb-1">
                                                    <span class="badge bg-primary">@g.ModuleName</span>

                                                    @if (g.Status == "pending")
                                                    {
                                                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle">Nicht beantwortet</span>
                                                    }
                                                    else if (g.Status == "approved")
                                                    {
                                                        <span class="badge bg-success-subtle text-success border border-success-subtle">Genehmigt</span>
                                                    }
                                                    else if (g.Status == "rejected")
                                                    {
                                                        <span class="badge bg-danger-subtle text-danger border border-danger-subtle">Abgelehnt</span>
                                                    }
                                                </div>

                                                <h5 class="fw-bold mb-1">
                                                    @g.StudentName <span class="text-muted fw-normal">(@g.CourseName)</span>
                                                </h5>

                                                <div class="text-muted small mb-2">
                                                    Rektor: @g.RektorName
                                                </div>

                                                @if (!string.IsNullOrWhiteSpace(g.Comment))
                                                {
                                                    <div class="mt-2 p-2 bg-body-tertiary border rounded small">
                                                        <strong>Bemerkung:</strong> @g.Comment
                                                    </div>
                                                }

                                                @if (!string.IsNullOrWhiteSpace(g.DecisionNote))
                                                {
                                                    <div class="mt-2 p-2 bg-body-tertiary border rounded small">
                                                        <strong>Entscheid-Notiz:</strong> @g.DecisionNote
                                                    </div>
                                                }
                                            </div>

                                            <div class="text-end">
                                                <div class="display-6 fw-bold text-primary">@g.GradeValue</div>

                                                @if (g.Status == "pending")
                                                {
                                                    <button class="btn btn-outline-primary btn-sm mt-2"
                                                            @onclick="() => OpenEditModal(g)">
                                                        <i class="bi bi-pencil"></i> Bearbeiten
                                                    </button>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }
                        }
                    }
                }

                @if (showEditModal && editGrade != null)
                {
                    <div class="modal fade show d-block" style="background: rgba(0,0,0,0.5);">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title">Anfrage bearbeiten (nur offen)</h5>
                                    <button type="button" class="btn-close btn-close-white" @onclick="CloseEditModal"></button>
                                </div>

                                <div class="modal-body">
                                    @if (!string.IsNullOrWhiteSpace(editError))
                                    {
                                        <div class="alert alert-danger">@editError</div>
                                    }

                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-bold small text-secondary">Modul</label>
                                            <InputText class="form-control" placeholder="z. B. M123" @bind-Value="editForm.ModuleName" />
                                        </div>

                                        <div class="col-md-6 mb-3">
                                            <label class="form-label fw-bold small text-secondary">Klasse</label>
                                            <InputText class="form-control" placeholder="z. B. INFA1a" @bind-Value="editForm.CourseName" />
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-8 mb-3">
                                            <label class="form-label fw-bold small text-secondary">Schüler</label>
                                            <InputText class="form-control" placeholder="Max Muster" @bind-Value="editForm.StudentName" />
                                        </div>

                                        <div class="col-md-4 mb-3">
                                            <label class="form-label fw-bold small text-secondary">Note</label>
                                            <InputNumber class="form-control text-center fw-bold" @bind-Value="editForm.GradeValue" Min="1" Max="6" Step="0.1" />
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold small text-secondary">Rektor</label>
                                        <InputSelect class="form-select" @bind-Value="editForm.RektorId">
                                            <option value="0">-- Wählen Sie einen Rektor --</option>
                                            @foreach (var rektor in Rektoren)
                                            {
                                                <option value="@rektor.Id">@rektor.Name</option>
                                            }
                                        </InputSelect>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label fw-bold small text-secondary">Bemerkung</label>
                                        <InputTextArea class="form-control" rows="3" @bind-Value="editForm.Comment" />
                                    </div>

                                    <div class="text-muted small">
                                        Hinweis: Bearbeiten ist nur möglich solange die Anfrage <strong>offen</strong> ist.
                                    </div>
                                </div>

                                <div class="modal-footer">
                                    <button class="btn btn-light" @onclick="CloseEditModal">Abbrechen</button>

                                    @if (editGrade?.Status == "pending")
                                    {
                                        <button class="btn btn-danger me-auto" @onclick="DeleteGrade">
                                            <i class="bi bi-trash"></i> Löschen
                                        </button>
                                    }

                                    <button class="btn btn-primary" @onclick="SaveEdit">
                                        <i class="bi bi-check2"></i> Speichern
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>
    </div>
}
else if (Role == "rektor")
{
    <!-- ================== PROREKTOR HEADER ================== -->
    <nav class="navbar navbar-expand-lg border-bottom shadow-sm sticky-navbar @(IsDark ? "bg-dark navbar-dark" : "bg-white navbar-light")">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="https://www.edu.ch/media/wysiwyg/edu/schulen/gibz.png?v=1" alt="GIBZ Logo" height="40">
                <span class="ms-2 badge @(IsDark ? "bg-secondary text-light" : "bg-dark text-white")">PROREKTORAT</span>
            </a>

            <div class="d-flex align-items-center ms-auto gap-2">
                <div class="form-check form-switch mb-0">
                    <input class="form-check-input" type="checkbox" role="switch" checked="@IsDark" @onchange="ToggleTheme" />
                    <label class="form-check-label small ms-1">
                        <i class="bi @(IsDark ? "bi-moon-stars-fill" : "bi-sun-fill")"></i>
                    </label>
                </div>

                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" data-bs-display="static" aria-expanded="false">
                        <i class="bi bi-link"></i>
                    </button>

                    <ul class="dropdown-menu">
                        <li>
                            <a class="dropdown-item" href="https://www.zg.ch/behoerden/volkswirtschaftsdirektion/gibz">
                                <i class="bi bi-house-door-fill"></i> | GIBZ Homepage
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="https://moodle.gibz.ch/anmelden/">
                                <i class="bi bi-list-task"></i> | Moodle
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="https://gibz.sharepoint.com/">
                                <i class="bi bi-bookmark-fill"></i> | Intranet
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="https://gibz.zg.ch/">
                                <i class="bi bi-person-workspace"></i> | schulNetz GIBZ
                            </a>
                        </li>

                        <li><hr class="dropdown-divider"></li>

                        <li>
                            <a class="dropdown-item" href="mailto:info@gibz.ch?subject=Notennachfrage%20GIBZ">
                                <i class="bi bi-envelope-fill"></i> | Kontaktieren <br /> Sie Uns!
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="vr mx-2"></div>

                <button class="btn btn-outline-danger btn-sm" @onclick="Logout">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </button>
            </div>
        </div>
    </nav>

    <div class="border-bottom shadow-sm sticky-navbar @(IsDark ? "bg-dark text-light" : "bg-white")" style="top:56px;">
        <div class="container">
            <ul class="nav nav-underline gap-3">
                <li class="nav-item">
                    <button class="btn nav-link @(activeTab == "pending" ? "active" : "") @(IsDark ? "text-light" : "")" @onclick='() => activeTab = "pending"'>
                        <i class="bi bi-inbox-fill text-primary"></i> Offen
                        <span class="badge bg-primary-subtle text-primary border border-primary-subtle ms-1 rounded-pill">
                            @PendingGrades.Count
                        </span>
                    </button>
                </li>

                <li class="nav-item">
                    <button class="btn nav-link @(activeTab == "approved" ? "active" : "") cursor-pointer"
                            @onclick='() => activeTab = "approved"'>
                        <i class="bi bi-check-circle-fill text-success"></i> Genehmigt
                        <span class="badge bg-success-subtle text-success border border-success-subtle ms-1 rounded-pill">
                            @ApprovedGrades.Count
                        </span>
                    </button>
                </li>

                <li class="nav-item">
                    <button class="btn nav-link @(activeTab == "rejected" ? "active" : "") cursor-pointer"
                            @onclick='() => activeTab = "rejected"'>
                        <i class="bi bi-x-circle-fill text-danger"></i> Abgelehnt
                        <span class="badge bg-danger-subtle text-danger border border-danger-subtle ms-1 rounded-pill">
                            @RejectedGrades.Count
                        </span>
                    </button>
                </li>
            </ul>
        </div>
    </div>

    <div class="container content-padding" style="padding-top: 120px;">
        @if (activeTab == "pending")
        {
            if (PendingGrades.Count == 0)
            {
                <div class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                    <h3 class="text-muted mt-3">Keine Anträge</h3>
                </div>
            }
            else
            {
                @foreach (var g in PendingGrades)
                {
                    <div class="card shadow-sm border-0 mb-3 @(IsDark ? "bg-dark text-light border-secondary" : "")">
                        <div class="card-body p-4">
                            @if (g.GetType().GetProperty("CreatedAt") != null)
                            {
                                var createdAt = (DateTime?)g.GetType().GetProperty("CreatedAt")!.GetValue(g);
                                if (createdAt.HasValue)
                                {
                                    <div class="d-flex justify-content-between mb-3 border-bottom pb-2">
                                        <span class="text-muted small">
                                            <i class="bi bi-calendar3"></i> @g.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy")
                                        </span>
                                        <span class="text-muted small">
                                            <i class="bi bi-clock"></i> @g.CreatedAt.ToLocalTime().ToString("HH:mm") Uhr
                                        </span>
                                    </div>
                                }
                            }

                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <span class="badge bg-primary me-2">@g.ModuleName</span>

                                    <h4 class="fw-bold mb-1">
                                        @g.StudentName
                                        <span class="text-muted fw-normal fs-6">(@g.CourseName)</span>
                                    </h4>

                                    <div class="text-muted small mb-3">Von: @g.TeacherName</div>

                                    @if (!string.IsNullOrWhiteSpace(g.Comment))
                                    {
                                        <div class="mt-2 p-2 bg-light border rounded small">
                                            <strong>Bemerkung:</strong> @g.Comment
                                        </div>
                                    }
                                </div>

                                <div class="col-md-4 text-center border-start-md">
                                    <div class="grade-badge mb-3 bg-success-subtle text-success border border-success">
                                        @g.GradeValue
                                    </div>

                                    <div class="d-flex gap-2 w-100 justify-content-center">
                                        <button class="btn btn-outline-danger flex-grow-1"
                                                @onclick='() => OpenModal("rejected", g.Id)'>
                                            Ablehnen
                                        </button>
                                        <button class="btn btn-success flex-grow-1"
                                                @onclick='() => OpenModal("approved", g.Id)'>
                                            Genehmigen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        }
        else if (activeTab == "approved")
        {
            if (ApprovedGrades.Count == 0)
            {
                <div class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                    <h3 class="text-muted mt-3">Keine genehmigten Anträge</h3>
                </div>
            }
            else
            {
                @foreach (var g in ApprovedGrades)
                {
                    <div class="card shadow-sm border-0 mb-3">
                        <div class="card-body p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8 opacity-75">
                                    <span class="badge bg-secondary me-2">@g.ModuleName</span>

                                    <h4 class="fw-bold mb-1">
                                        @g.StudentName
                                        <span class="text-muted fw-normal fs-6">(@g.CourseName)</span>
                                    </h4>

                                    <div class="text-muted small">Von: @g.TeacherName</div>
                                </div>

                                <div class="col-md-4 text-center border-start-md">
                                    <div class="grade-badge mb-3 bg-light text-dark border">@g.GradeValue</div>
                                    <div class="text-success fw-bold">Genehmigt</div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        }
        else if (activeTab == "rejected")
        {
            if (RejectedGrades.Count == 0)
            {
                <div class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                    <h3 class="text-muted mt-3">Keine abgelehnten Anträge</h3>
                </div>
            }
            else
            {
                @foreach (var g in RejectedGrades)
                {
                    <div class="card shadow-sm border-0 mb-3">
                        <div class="card-body p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8 opacity-75">
                                    <span class="badge bg-secondary me-2">@g.ModuleName</span>

                                    <h4 class="fw-bold mb-1">
                                        @g.StudentName
                                        <span class="text-muted fw-normal fs-6">(@g.CourseName)</span>
                                    </h4>

                                    <div class="text-muted small">Von: @g.TeacherName</div>
                                </div>

                                <div class="col-md-4 text-center border-start-md">
                                    <div class="grade-badge mb-3 bg-light text-dark border">@g.GradeValue</div>
                                    <div class="text-danger fw-bold">Abgelehnt</div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
        }

        @if (showModal)
        {
            <div class="modal fade show d-block" style="background: rgba(0,0,0,0.5);">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header @(modalType == "approved" ? "bg-success" : "bg-danger") text-white">
                            <h5 class="modal-title">Antrag @(modalType == "approved" ? "genehmigen" : "ablehnen")</h5>
                            <button type="button" class="btn-close btn-close-white" @onclick="CloseModal"></button>
                        </div>

                        <div class="modal-body">
                            <p>Möchten Sie diese Aktion wirklich durchführen?</p>
                            <textarea class="form-control" rows="3" placeholder="Begründung / Notiz..." @bind="decisionNote"></textarea>
                        </div>

                        <div class="modal-footer">
                            <button class="btn btn-light" @onclick="CloseModal">Abbrechen</button>
                            <button class="btn @(modalType == "approved" ? "btn-success" : "btn-danger")"
                                    @onclick="ConfirmProrektorAction">
                                Bestätigen
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}