@page "/twofactor"

<PageTitle>Zwei-Faktor-Auth</PageTitle>

<div class="container py-5 @(IsDark ? "text-light" : "text-dark")">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-4">
            <div class="card shadow border-0 rounded-3 mt-4 @(IsDark ? "bg-dark text-light" : "")">
                <div class="card-body p-4 text-center">
                    <div class="mb-3 text-primary">
                        <i class="bi bi-shield-lock-fill" style="font-size: 3rem;"></i>
                    </div>
                    <h4 class="fw-bold mb-2">Zwei-Faktor-Authentifizierung</h4>
                    <p class="text-muted small mb-4">
                        Wir haben einen 6-stelligen Code an Ihre hinterlegte E-Mail gesendet.
                    </p>

                    <form @onsubmit="VerifyCode" @onsubmit:preventDefault>
                        <div class="mb-4">
                            <label class="form-label visually-hidden">Sicherheitscode</label>
                            <input @bind="Code" type="text"
                                   class="form-control form-control-lg code-input @(IsDark ? "bg-secondary text-light border-light" : "")"
                                   placeholder="000000" maxlength="6" required />
                        </div>

                        <div class="d-grid mb-3">
                            <button type="submit" class="btn btn-primary btn-lg" disabled="@isLoading">
                                @if (isLoading)
                                {
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true">Prüfen...</span>
                                }
                                else
                                {
                                    <span>Bestätigen</span>
                                }
                            </button>
                        </div>

                        <div class="text-center">
                            <a href="#"
                               class="text-decoration-none small @(IsDark ? "text-info" : "text-primary")"
                               @onclick="ResendCode"
                               @onclick:preventDefault
                               disabled="@isResending">
                                @if (isResending)
                                {
                                    <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                                    <span> Senden...</span>
                                }
                                else
                                {
                                    <span>Code nicht erhalten? Erneut senden</span>
                                }
                            </a>
                            @if (!string.IsNullOrEmpty(ResendMessage))
                            {
                                <div class="mt-2 text-center @(IsDark ? "text-info" : "text-primary")">
                                    @ResendMessage
                                </div>
                            }
                        </div>

                        <div class="mt-3">
                            <a href="/" class="text-decoration-none small text-danger"><i class="bi bi-arrow-left"></i> Zurück zum Login</a>
                        </div>

                        @if (!string.IsNullOrEmpty(ErrorMessage))
                        {
                            <div class="alert alert-danger mt-2 text-center">@ErrorMessage</div>
                        }
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>